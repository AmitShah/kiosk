<!doctype html manifest="kiosk.appcache">
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>Promo Network</title>
	<meta name="description" content="">
	<meta name="author" content="">

	<meta name="viewport" content="width=device-width,initial-scale=1">

	<link rel="stylesheet" href="{{ static_url("web/css/style.css")}}">

	
	<script src="{{ static_url("web/js/libs/modernizr-2.0.6.min.js")}}"></script>
	<script src="{{ static_url("web/js/libs/jquery-1.10.2.min.js")}}"></script>
	
	<script src="{{ static_url("web/js/libs/jquery-mobile.1.3.1.min.js")}}"></script>
	
</head>
<body>

	<div id="header-container">
		<header class="wrapper clearfix">
			<h1 id="title">Shoppers Network</h1>
			<nav>
				<ul>
					<li><a href="#">My Coupons</a></li>
				</ul>
			</nav>
		</header>
	</div>
	<div id="main-container">
		<div id="main" class="wrapper clearfix">
			<div id="new_data"></div>
			<article id="article">
				<header>
					<h1 id="status">Header</h1>
				</header>
				<!--section class="active">
					<div class="check-active" style="position:absolute;"><img src="{{ static_url("web/img/check.png")}}"></img></div>
					<div class="coupon-inner inactive">
						<img class="coupon-image" src="{{ static_url("web/img/axe.jpg")}}"></img>
					</div>
				</section>
				<section class="active">
					<div class="check-active" style="position:absolute;"><img src="{{ static_url("web/img/check.png")}}"></img></div>
					<div class="coupon-inner inactive">
						<img class="coupon-image" src="{{ static_url("web/img/loreal.jpg")}}"></img>
					</div>
				</section>
				<section>
					<div class="check-inactive" style="position:absolute;"><img src="{{ static_url("web/img/check.png")}}"></img></div>
					<div class="coupon-inner">
						<img class="coupon-image" src="{{ static_url("web/img/axe.jpg")}}"></img>
					</div>
				</section>
				<section class="active">
					<div class="check-active" style="position:absolute;"><img src="{{ static_url("web/img/check.png")}}"></img></div>
					<div class="coupon-inner inactive">
						<img class="coupon-image" src="{{ static_url("web/img/loreal.jpg")}}"></img>
					</div>
				</section-->
				
			</article>
			
		</div> <!-- #main -->
	</div> <!-- #main-container -->

	<div id="footer-container">
		<footer class="wrapper">
			<h3>footer</h3>
		</footer>
	</div>

</body>
<script type="text/javascript">
	if (Modernizr.localStorage){
		//local storage is available
	}else{
		//output coupons will not be saved :( 
	}
	
	
	var runApp = function(){
		//creating streaming connection for future use case
		try{
			var ws = new WebSocket("ws://localhost:8080/activate");
			ws.onopen = function() {
			  $('#status').html('connection established...'); 			   
			};
			ws.onmessage = function (evt)
			{
			  
			};
			ws.onclose = function()
			{
			  // websocket is closed.
			  retry();
			};
		}catch(e) {
			retry();
		}
		
		//retrieve current offers available from kiosk
		$.ajax({
		  url: '/coupon',
		  dataType:'json',
		  //data: data,
		  success: function(data){
		      var d = $('#article');
		      for(var key in data){
		      	
		      	var str = '<img src="data:image/jpeg;base64,'+data[key]+'" />';
		      	d.append(str);
		      }
		  },
		  error: function(e){
		  	$('#status').html('error retreiving coupons...');
		  }
		  
		});
	}
	
	var retry = function(){
		$('#status').html('waiting for connection...');
		setTimeout(runApp, 1000);
	}
	runApp();
	
</script>
  <section>
	<div class="check-inactive" style="position:absolute;"><img src="{{ static_url("web/img/check.png")}}"></img></div>
	  <div class="coupon-inner">
	    <img class="coupon-image" src="{{ static_url("web/img/axe.jpg")}}"></img>
	  </div>
  </section>
<script>

</html>
